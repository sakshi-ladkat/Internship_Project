<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Create Account</title>

<!-- Page styling -->
<link rel="stylesheet" href="../assets/css/create_account.css">
</head>

<body>

<!-- Dynamic Header -->
<div id="header"></div>

<!-- Account Creation Form -->
<div class="container">

    <h2>Create New Account</h2>
    <p>Your email has been verified. Please create your account.</p>

    <form id="createAccountForm">

        <!-- Email (auto-filled, read-only) -->
        <div class="label">Email</div>
        <input
            type="email"
            id="email"
            name="email"
            readonly
            required
        >

        <!-- Username (auto-generated from email) -->
        <div class="label">Username</div>
        <input
            type="text"
            id="username"
            name="username"
            readonly
        >

        <!-- Password -->
        <div class="label">Password</div>
        <input
            type="password"
            name="password"
            placeholder="Choose Password"
            required
        >
        <br><br>
        <!-- Confirm Password -->
        <input
            type="password"
            name="password_confirmation"
            placeholder="Confirm Password"
            required
        >

        <!-- Submit -->
        <button type="submit">Create Account</button>

        <!-- Message Area -->
        <p id="message" class="message"></p>
    </form>

</div>

<!-- Dynamic Footer -->
<div id="footer"></div>

<script src="../assets/js/layout.js"></script>

<script>
/* ----------------------------------------
   Auto-fill email from URL
   Example:
   create_account.html?email=test@gmail.com
----------------------------------------- */
const params = new URLSearchParams(window.location.search);
const email = params.get('email');

if (email) {
    document.getElementById('email').value = email;

    // Auto-generate username
    const username = email.split('@')[0];
    document.getElementById('username').value = username;
}

/* ----------------------------------------
   Submit account creation request
----------------------------------------- */
document.getElementById('createAccountForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    const formData = new FormData(this);

    try {
        const response = await fetch('http://127.0.0.1:8000/create-account', {
            method: 'POST',
            headers: {
                'Accept': 'application/json'
            },
            body: formData
        });

        const data = await response.json();

        if (response.ok) {
            document.getElementById('message').innerText =
                'Account created successfully. You may now log in.';
        } else {
            document.getElementById('message').innerText =
                data.message || 'Account creation failed.';
        }
    } catch (error) {
        document.getElementById('message').innerText =
            'Server error. Please try again.';
    }
});
</script>

</body>
</html>
